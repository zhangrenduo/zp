$(document).ready(function(){$("#send_sms").bind("click",click_sendsms);$("#modPhone").bind("click",ShowModifyPop);$("#cancel_mpop").click(function(){hide_mpop()});$("#verify_yzm").click(function(){var g=$("#mpverifystatus").val();var b=filterTitle($("#phonenum")).trim();var e=filterTitle($("#smscode"));var d=$("#mpcountry").attr("value");var c=false;if(b==""){$("#err_phonenum").show().find("span").html("请输入手机号");$("#phonenum").focus();return false}else{if(b.indexOf("-")>"-1"&&!(d==""||d=="086"||d=="000")){$("#err_phonenum").show().find("span").html("抱歉，当前仅限大陆手机号");$("#phonenum").focus();return false}else{if(!isPhone(b)){$("#err_phonenum").show().find("span").html("请正确输入手机号");$("#phonenum").focus();return false}else{if((b.length<8||b.length>=15)||isNaN(b)==true){$("#err_phonenum").show().find("span").html("手机号格式错误");$("#phonenum").focus();return false}else{if(b.length>15||isNaN(b)==true){$("#err_phonenum").show().find("span").html("手机号格式错误");$("#phonenum").focus();return false}}}}}if(e==""){$("#err_smscode").show().find("span").html("请输入验证码");$("#smscode").focus();return false}var f=$_CONFIG.domain+"/ajax/my/bindphone.ajax.php?";var h={code:e,mobilephone:b};var a=ajaxRequest(f,h,"get","json");if(a.status==1){hide_mpop();pop.ini({msg:"保存成功！<br>可使用新认证的手机号进行登录！"},{title:"确定"});$("#mobilephone").val(b);$("#mobilephone").next().html("修改");$("input[id=mpverifystatus]").val(3);if($("#err_mobilephone").css("display")=="block"){$("#err_mobilephone").hide()}return}else{$("#err_smscode").show().find("span").html(a.desc);return}})});var time_binphone=60;function countDown(){$("#send_sms").removeClass("b_light").addClass("b_gray");$("#send_sms").unbind("click");if(time_binphone>0){time_binphone--;$("#send_sms").text(time_binphone+"秒后重发");var a=setTimeout("countDown()",1000)}else{time_binphone=60;$("#send_sms").text("重新发送");$("#send_sms").removeClass("b_gray").addClass("b_light");$("#send_sms").bind("click",click_sendsms)}}var click_sendsms=function(){var e=$("#mpverifystatus").val();var b=filterTitle($("#phonenum")).trim();var d=$("#mpcountry").attr("value");var a="";if(b==""){$("#err_phonenum").show().find("span").html("请输入手机号");$("#phonenum").focus();return false}else{if(b.indexOf("-")>"-1"&&!(d==""||d=="086"||d=="000")){$("#err_phonenum").show().find("span").html("抱歉，当前仅限大陆手机号");$("#phonenum").focus();return false}else{if(!isPhone(b)){$("#err_phonenum").show().find("span").html("手机号格式错误");$("#phonenum").focus();return false}else{if(b.length>15||isNaN(b)==true){$("#err_phonenum").show().find("span").html("手机号格式错误");$("#phonenum").focus();return false}}}}var c=filterTitle($("#mobilephone"));var g=c.split("-");if(c!=""){if(g[1]){var f=d+"-"+b;var f=f.substr(1);if(c==f&&e==3){$("#err_phonenum").show().find("span").html("请输入新的手机号码！");$("#phonenum").focus();return true}}else{if(c==b&&e==3){$("#err_phonenum").show().find("span").html("请输入新的手机号码！");$("#phonenum").focus();return true}}}sendSms(a,b)};var sendSms=function(c,b){var d=$_CONFIG.domain+"/ajax/my/sendverifycode.ajax.php?";var e={code:c,mobilephone:b};var a=ajaxRequest(d,e,"get","json");if(a.status==1){countDown()}else{$("#err_smscode").show().find("span").html(a.desc);if(a.type==2){$("#send_sms").attr("disabled","disabled")}return false}};function isEmail(a){return true}function isPhone(a){var b=/^(1[3456789]{1,1}[0-9]{9,9})$/;return b.test(a)}var modMobilePhone=function(){var g=$("#mpcountry").val(),b=$("#mobilephone").val(),c=$("#b_mpcountry").val(),e=$("#b_mobilephone").val().replace(/[ ]/g,"");if(e==""){pop("请输入手机号",1);return false}if(c=="000"){if(!/^[0-9]{1,20}$/.test(e)){pop("请正确输入手机号",1);return false}}else{if(!/^1[3456789]{1,1}[0-9]{9,9}$/.test(e)){pop("请正确输入手机号",1);return false}}if(g==c&&b==e){pageclose();return false}var d=domain+"ajax/my/changephone.ajax.php";var f={mpcountry:c,mobilephone:e};var a=ajaxRequest(d,f,"post","json");if(a.status==1){if($("#mobilephone")[0]){$("#mobilephone").val(e);if(m_template.length>0&&($("#template").val()=="resume/resume1"||$("#template").val()=="resume/pasteresume1")){$("#mobilephone").next().html(e)}if(g!=c){if(c=="086"){$(".dalu").click();$("#mpcountry").val("086")}else{$(".qita").click();$("#mpcountry").val("000")}}}pageclose();pop(a.desc)}else{if(a.url){location.href=a.url}else{pop(a.desc,1);return false}}};function ShowModifyPop(){var a=$("#mobilephone").val();$("#popMobile,#shadow").show();if($(".popfm .phonenum").val()==""){$(".popfm .phonenum").val(a)}}function hide_mpop(){$("#popMobile,#shadow").hide();return false}if("oninput" in document){$("#phonenum,smscode").bind("input",function(){$("#err_"+$(this).attr("id")).hide()})}else{$("#phonenum,smscode").keydown(function(){$("#err_"+$(this).attr("id")).hide()})};