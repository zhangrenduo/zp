function selectFileImage(e,a,d){
    var b=e;b=event.target.files[0];rFilter=/^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/gif|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;
    if(!rFilter.test(b.type)){pop.msg("请选择正确的图片（jpg、gif、png）!");return}
    if(b){EXIF.getData(b,function(){EXIF.getAllTags(this);Orientation=EXIF.getTag(this,"Orientation")});var c=new FileReader();c.onload=function(g){var f=new Image();f.src=g.target.result;f.addEventListener("load",function(){var j=this.naturalWidth;var l=this.naturalHeight;
        if(this.naturalWidth>this.naturalHeight&&this.naturalWidth>400){j=400;l=j*this.naturalHeight/this.naturalWidth}else{
            if(this.naturalHeight>this.naturalWidth&&this.naturalHeight>410){l=410;j=l*this.naturalWidth/this.naturalHeight}}var k=document.createElement("canvas");var i=k.getContext("2d");k.width=j;k.height=l;i.drawImage(this,0,0,j,l);var h=null;
            if(Orientation!=""&&Orientation!=1){console.log(Orientation);switch(Orientation){case 6:rotateImg(this,"left",k);break;case 8:rotateImg(this,"right",k);break;case 3:rotateImg(this,"right",k);rotateImg(this,"right",k);break}}h=k.toDataURL("image/jpeg");canvasDataURL(h,410,400,function(n){var m=n.toDataURL("image/jpeg");var p=m.substr(m.indexOf(",")+1);var q={photo:p,userid:$("#userid").val()};var o=$.ajax({url:$_CONFIG.domain+"/ajax/resume/uploadheadpic.ajax.php",asyn:false,dataType:"json",type:"post",data:q,success:function(r){if(r.status==1){if(r.message){pop.msg(r.message);setTimeout("pop.close()",3000)}$("#viewpic").attr("src","data:image/jpg;base64,"+r.photo)}else{if(r.status==0&&r.url){location.href=r.url;return false}else{if(r.message){pop.msg(r.message)}}}},error:function(r,t,s){pop.close()}})})});$(f).error(function(){pop.msg("请上传正确的图片");setTimeout("pop.close()",3000)})};c.readAsDataURL(b)}}function rotateImg(f,g,c){var a=0;var h=3;if(f==null){return}var i=f.height;var b=f.width;var d=2;if(d==null){d=a}if(g=="right"){d++;d>h&&(d=a)}else{d--;d<a&&(d=h)}var e=d*90*Math.PI/180;var j=c.getContext("2d");switch(d){case 0:c.width=b;c.height=i;j.drawImage(f,0,0);break;case 1:c.width=i;c.height=b;j.rotate(e);j.drawImage(f,0,-i);break;case 2:c.width=b;c.height=i;j.rotate(e);j.drawImage(f,-b,-i);break;case 3:c.width=i;c.height=b;j.rotate(e);j.drawImage(f,-b,0);break}}function canvasDataURL(d,a,c,f){var e=new Image();e.src=d;var b=imgHeight=offsetX=offsetY=htm=0;e.onload=function(){var h=document.createElement("img");h.src=e.src;b=h.width;imgHeight=h.height;var i=document.createElement("canvas");i.width=a;i.height=c;var g=i.getContext("2d");g.clearRect(0,0,a,c);g.drawImage(h,"","",410,400);f(i)}};